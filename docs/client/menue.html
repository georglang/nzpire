<!DOCTYPE html><html lang="en"><head><title>client/menue</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="client/menue"><meta name="groc-project-path" content="app/client/menue.coffee"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">app/client/menue.coffee</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="navigation-events">Navigation Events</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nx">Template</span><span class="p">.</span><span class="nx">menue</span><span class="p">.</span><span class="nx">events</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="news">News</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="s">&#39;click #news&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;clicked news&quot;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">news</span><span class="p">()</span>
    <span class="kc">false</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="index">Index</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="s">&#39;click .brand&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;clicked home&quot;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>
    <span class="kc">false</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="model">Model</h2>

<p>Replaces the navigation Elemente with an input field where a new model can be created</p></div></div><div class="code"><div class="wrapper">  <span class="s">&#39;click #model&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;clicked model&quot;</span>
    <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#newModel&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#model&#39;</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="s">&quot;&lt;li id=&#39;newModel&#39;&gt;&lt;input autofocus=&#39;autofocus&#39; id=&#39;modelName&#39; type=&#39;text&#39; placeholder=&#39;Modelname&#39;&gt;&lt;input type=&#39;button&#39; id=&#39;createNewModel&#39; value=&#39;Create&#39;&gt;&lt;/li&gt;&quot;</span><span class="p">)</span>
    <span class="kc">false</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="create-model">Create Model</h2>

<p>Checks if the input field is empty and tries to create a new model and handels the callback</p></div></div><div class="code"><div class="wrapper">  <span class="s">&#39;click #createNewModel&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nv">modelName = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#modelName&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#errorNewModel&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">undefined</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#errorNewModel&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>

    <span class="nv">options = </span><span class="p">{</span><span class="nv">name: </span><span class="nx">modelName</span><span class="p">,</span> <span class="nv">predecessor: </span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">creator: </span><span class="nx">currentProfile</span><span class="p">().</span><span class="nx">_id</span><span class="p">,</span><span class="nv">isPublic: </span><span class="kc">false</span><span class="p">}</span>
    <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span> <span class="s">&#39;createModel&#39;</span><span class="p">,</span><span class="nx">options</span><span class="p">,</span> <span class="nf">(error,modelId)-&gt;</span>
      <span class="k">if</span> <span class="nx">error</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#createNewModel&#39;</span><span class="p">).</span><span class="nx">after</span><span class="p">(</span><span class="s">&quot;&lt;div id=&#39;errorNewModel&#39;&gt;&quot;</span><span class="o">+</span><span class="nx">error</span><span class="p">.</span><span class="nx">reason</span><span class="o">+</span><span class="s">&quot;&lt;/div&gt;&quot;</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#newModel&#39;</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="s">&quot;&lt;a href=&#39;</span><span class="err">#</span><span class="s">&#39; id=&#39;model&#39;&gt;Create new Model&lt;/a&gt;&quot;</span><span class="p">)</span>
        <span class="nx">Workspace</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="nx">modelId</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Triggers a click Event on #createNewModel if the input key == Enter button </p></div></div><div class="code"><div class="wrapper">  <span class="s">&#39;keydown #modelName&#39;</span><span class="o">:</span> <span class="nf">(e)-&gt;</span>
    <span class="nx">Meteor</span><span class="p">.</span><span class="nx">defer</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">13</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#createNewModel&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">27</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#newModel&#39;</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="s">&quot;&lt;a href=&#39;</span><span class="err">#</span><span class="s">&#39; id=&#39;model&#39;&gt;Create new Model&lt;/a&gt;&quot;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="profile">Profile</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="s">&#39;click #profile&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;clicked profile&quot;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">profile</span><span class="p">(</span><span class="nx">currentProfile</span><span class="p">().</span><span class="nx">_id</span><span class="p">)</span>
    <span class="kc">false</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="search">Search</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="s">&#39;click #search&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;clicked search&quot;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">search</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;searchQuery&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
    <span class="kc">false</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Triggers a search if the query length > 2 or keydown == Enter button</p></div></div><div class="code"><div class="wrapper">  <span class="s">&#39;keydown #searchQuery&#39;</span><span class="o">:</span> <span class="nf">(e)-&gt;</span>
    <span class="nx">Meteor</span><span class="p">.</span><span class="nx">defer</span> <span class="o">-&gt;</span>
      <span class="nv">searchQuery = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;searchQuery&quot;</span><span class="p">).</span><span class="nx">value</span>
      <span class="k">if</span> <span class="nx">searchQuery</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">13</span>
        <span class="nx">Workspace</span><span class="p">.</span><span class="nx">search</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">searchQuery</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">searchQuery</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#searchresult&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">()</span>
        <span class="nx">Workspace</span><span class="p">.</span><span class="nx">search</span> <span class="s">&quot;&quot;</span>

  <span class="s">&#39;focus #searchQuery&#39;</span><span class="o">:</span> <span class="nf">(e)-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;activeSearchQuery&quot;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="model-showroom">Model Showroom</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="s">&#39;click #modelShowroom&#39;</span><span class="o">:</span> <span class="nf">()-&gt;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">modelShowroom</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Redirects to Index on logout</p></div></div><div class="code"><div class="wrapper">  <span class="s">&#39;click #login-buttons-logout&#39;</span><span class="o">:</span> <span class="nf">()-&gt;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>
  
  <span class="s">&#39;click #impressum&#39;</span><span class="o">:</span> <span class="nf">()-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;clicked impressum&quot;</span>
    <span class="nx">Workspace</span><span class="p">.</span><span class="nx">impressum</span><span class="p">()</span>
    <span class="kc">false</span>

<span class="nv">Template.menue.searching = </span><span class="o">-&gt;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;search&#39;</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="k">return</span> <span class="kc">true</span>

<span class="nv">Template.menue.searchQueryClass = </span><span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#searchQuery&#39;</span><span class="p">).</span><span class="o">is</span><span class="p">(</span><span class="s">&#39;:focus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;search&#39;</span>
      <span class="k">return</span> <span class="kc">false</span>
  <span class="k">return</span> <span class="s">&#39;activeSearchQuery&#39;</span>

<span class="nx">Meteor</span><span class="p">.</span><span class="nx">startup</span> <span class="o">-&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">mouseup</span> <span class="nf">(e)-&gt;</span>
    <span class="nv">searchParent = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">searchParent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">searchParent</span><span class="o">?</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">Session</span><span class="p">.</span><span class="nx">set</span> <span class="s">&#39;search&#39;</span><span class="p">,</span> <span class="kc">null</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#searchQuery&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;activeSearchQuery&#39;</span><span class="p">)</span></div></div></div></div></body></html>